---
layout: post
title: "Diffusion Models 完全入门指南"
date: 2025-02-27
categories: [深度学习, 生成式AI]
tags: [Diffusion Models, DDPM, DDIM, PyTorch]
author: Yiyu Qiu
---

## 前言

这是我在研究扩散模型(Diffusion Models)过程中的一些心得总结。本文将从理论到实践,系统介绍 Diffusion Models 的核心原理。

## 什么是 Diffusion Models?

扩散模型是一类基于逐步去噪的生成模型,通过学习数据分布的逆扩散过程来生成新样本。

### 核心思想

1. **前向过程**: 逐步向数据添加高斯噪声
2. **反向过程**: 训练神经网络学习去噪过程

## 数学原理

### 前向扩散过程

给定初始数据 $x_0$,前向过程定义为:

$$q(x_t|x_{t-1}) = \mathcal{N}(x_t; \sqrt{1-\beta_t}x_{t-1}, \beta_t I)$$

### 代码实现

```python
import torch
import torch.nn as nn

class DiffusionModel(nn.Module):
    def __init__(self, timesteps=1000):
        super().__init__()
        self.timesteps = timesteps
        # 定义 beta schedule
        self.betas = self.linear_beta_schedule(timesteps)
        
    def linear_beta_schedule(self, timesteps):
        beta_start = 0.0001
        beta_end = 0.02
        return torch.linspace(beta_start, beta_end, timesteps)
    
    def forward_diffusion(self, x0, t):
        """前向扩散过程"""
        noise = torch.randn_like(x0)
        sqrt_alpha_bar = self.sqrt_alphas_cumprod[t]
        sqrt_one_minus_alpha_bar = self.sqrt_one_minus_alphas_cumprod[t]
        
        # x_t = sqrt(alpha_bar) * x_0 + sqrt(1 - alpha_bar) * noise
        return sqrt_alpha_bar * x0 + sqrt_one_minus_alpha_bar * noise, noise
```

## 实践经验

### CIFAR-10 训练心得

在 CIFAR-10 数据集上训练 DDPM 模型时,我总结了以下经验:

1. **训练配置**
   - Batch Size: 128
   - Learning Rate: 2e-4
   - Optimizer: AdamW
   - Timesteps: 1000

2. **性能优化**
   - 使用混合精度训练(Mixed Precision)
   - Gradient Accumulation
   - EMA (Exponential Moving Average)

3. **常见问题**
   - 训练不稳定 → 调整学习率
   - 生成质量差 → 增加训练步数
   - 内存不足 → 减小 Batch Size

## 参考资料

- [Denoising Diffusion Probabilistic Models (DDPM)](https://arxiv.org/abs/2006.11239)
- [Denoising Diffusion Implicit Models (DDIM)](https://arxiv.org/abs/2010.02502)
- [我的 GitHub 实现](https://github.com/yyqiu35000/diffusion-models)

## 后记

这只是 Diffusion Models 的入门介绍,后续我会继续分享:
- Classifier-Free Guidance (CFG) 详解
- CelebA-64 实战经验
- 模型优化技巧

敬请期待!